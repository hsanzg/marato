<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dr√°cula</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="font-sans antialiased text-gray-600 bg-gray-100 min-h-full flex flex-col [overflow-anchor:none]" scroll-region="">
<nav class="bg-emerald-400">
  <div class="mx-auto max-w-7xl px-2 sm:px-6 lg:px-8">
    <div class="relative flex h-16 items-center justify-between">
      <div class="flex flex-1 items-center justify-center items-stretch justify-start">
        <div class="flex flex-shrink-0 items-center text-emerald-50 rounded-md px-3 py-2 text-sm font-bold text-xl tracking-tight">
          <a href=".">
          <!--<img class="h-8 w-auto" src="https://tailwindui.com/img/logos/mark.svg?color=white" alt="Your Company">-->
            <img class="h-7 w-auto" src="logo.svg" alt="PBAC">
          </a>
        </div>
      </div>
    </div>
  </div>
</nav>
<div class="flex min-h-full flex-col justify-center px-6 py-12">
<!-- Calendario -->
  <!--<div class="rounded-lg bg-white shadow-lg p-4 flex">
    <div class="px-2 py-3 text-center font-semibold"></div>
  </div>-->

  <div class="datepicker-picker inline-block rounded-lg bg-white shadow-lg p-4">
    <div class="datepicker-main p-1">
      <div class="datepicker-view flex flex-col" id="calendar"></div>
    </div>
  </div>
  <!-- Cycles list-->
<div class="rounded-lg bg-white shadow-lg p-4 flex mt-4">
<ul role="list" class="divide-y divide-gray-100">
  <li class="flex justify-between gap-x-6 py-5">
    <div class="flex min-w-0 gap-x-4">
      <!--<img class="h-12 w-12 flex-none rounded-full bg-gray-50" src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="">-->
      <!--<div class="min-w-0 flex-auto">
        <p class="text-sm font-semibold leading-6 text-gray-900">Leslie Alexander</p>
        <p class="mt-1 truncate text-xs leading-5 text-gray-500">leslie.alexander@example.com</p>
      </div>-->
    </div>
    <div class="shrink-0 sm:items-end text-sm text-center">
      <dt class="color-gray-800 font-medium font-sm">PBAC</dt>
      <dd class="tracking-tight font-bold text-xl" style="color: black;">23.4</dd>
    </div>
  </li>
</ul>
</div><!-- cycles list -->
</div>
<script src="registry.js"></script>
<script>
const MONTH_PREFIXES = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];

function avgLevelInWeek(cycles, year, month, week) {
  const monthStart = new Date(year, month - 1, 1);
  const weekStart = new Date(monthStart);
  weekStart.setDate(monthStart.getDate() + 7 * (week - 1));
  const weekEnd = new Date(weekStart);
  weekEnd.setDate(weekStart.getDate() + 7);
  //console.log({monthStart, weekStart, weekEnd});
  let total = 0;
  for (const cycle of cycles) {
    let date = new Date(cycle.start);
    if (weekStart <= date && date < weekEnd) {
      total += calcPbac(cycle);
    }
  }
  if (total === 0) return 0;
  const avgPbac = 192;
  const subBefore = 7;
  const levelStep = avgPbac / subBefore;
  if (total <= levelStep) return 50;
  if (total <= 2 * levelStep) return 100;
  if (total <= 3 * levelStep) return 200;
  if (total <= 4* levelStep) return 300;
  if (total <= 5 * levelStep) return 400;
  if (total <= 6* levelStep) return 500;
  if (total <= 7* levelStep) return 600;
  if (total <= 8* levelStep) return 700;
  if (total <= 9* levelStep) return 800;
  if (total <= 10* levelStep) return 900;
  return 950;
}

function displayYearTable(cycles) {
  cycles = [
  {
    start: new Date(2023, 10, 16),
    entries: [{date: new Date(2023, 10, 16), level: 20, kind: 'pad'}]
  }];
  const curMonth = 12;
  const startMonth = 9;
  const year = 2023;

  function createSpacer() {
    const spacer = document.createElement('span');
    spacer.className = 'col-span-3';
    return spacer;
  }

  function createMonthName(m) {
    const elem = document.createElement('span');
    elem.className = 'pl-1 h-5 leading-6 text-sm font-medium text-gray-500 text-center';
    elem.innerText = MONTH_PREFIXES[m - 1];
    return elem;
  }

  const calendar = document.getElementById('calendar');
  let grid;
  for (let m = startMonth; m <= curMonth; ++m) {
    if (m % 2 === 1) {
      const monthNames = document.createElement('div');
      monthNames.className = 'grid grid-cols-8';

      monthNames.appendChild(createMonthName(m));
      monthNames.appendChild(createSpacer());
      monthNames.appendChild(createMonthName(m + 1));
      calendar.appendChild(monthNames);
      grid = document.createElement('div');
      grid.className = 'grid grid-cols-8 mb-1';
      calendar.appendChild(grid);
    }

    for (let i = 1; i <= 4; ++i) {
      let week = document.createElement('span');
      week.className = 'block flex-1 leading-9 border-0 rounded-lg cursor-pointer text-center text-gray-900 font-semibold text-sm text-gray-500';
      const level = avgLevelInWeek(cycles, year, m, i);
      if (level > 0) {
        week.classList.add('bg-red-' + level);
        if (level >= 700) {
          week.classList.add('text-red-50');
        }
      }
      week.innerText = i;
      grid.appendChild(week);
    }
  }

  /*
  <div class="grid grid-cols-8">
          <span class="pl-1 h-5 leading-6 text-sm font-medium text-gray-500 text-center">Jul</span>
          <span class="col-span-3"></span>
          <span class="pl-1 h-5 leading-6 text-sm font-medium text-gray-500 text-center">Ago</span>
          <span class="col-span-3"></span>
        </div>
        <div class="grid grid-cols-8 mb-1">
          <span class="hover:bg-gray-100 block flex-1 leading-9 border-0 rounded-lg cursor-pointer text-center text-gray-900 font-semibold text-sm text-gray-500">26</span>
          <span class="hover:bg-gray-100 block flex-1 leading-9 border-0 rounded-lg cursor-pointer text-center text-gray-900 font-semibold text-sm text-gray-500">26</span>
          <span class="hover:bg-gray-100 block flex-1 leading-9 border-0 rounded-lg cursor-pointer text-center text-gray-900 font-semibold text-sm text-gray-500">26</span>
          <span class="hover:bg-gray-100 block flex-1 leading-9 border-0 rounded-lg cursor-pointer text-center text-gray-900 font-semibold text-sm text-gray-500">26</span>
          <span class="hover:bg-gray-100 block flex-1 leading-9 border-0 rounded-lg cursor-pointer text-center text-gray-900 font-semibold text-sm text-gray-500">26</span>
          <span class="hover:bg-gray-100 block flex-1 leading-9 border-0 rounded-lg cursor-pointer text-center text-gray-900 font-semibold text-sm text-gray-500">26</span>
          <span class="hover:bg-gray-100 block flex-1 leading-9 border-0 rounded-lg cursor-pointer text-center text-gray-900 font-semibold text-sm text-gray-500">26</span>
          <span class="hover:bg-gray-100 block flex-1 leading-9 border-0 rounded-lg cursor-pointer text-center text-gray-900 font-semibold text-sm text-gray-500">26</span>
          <span class="hover:bg-gray-100 block flex-1 leading-9 border-0 rounded-lg cursor-pointer text-center text-gray-900 font-semibold text-sm text-gray-500">26</span>*/
}

displayYearTable();
</script>
</body>
